<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlobalFin Customer 360 Platform | PwC Advisory</title>
    
    <!-- Google Fonts - Open Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica Neue', sans-serif;
            background: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }

        /* PwC Header */
        .header {
            background: #d04a02;
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: "Open Sans", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400;
            font-style: normal;
            font-variation-settings: "wdth" 100;
            font-size: 2em;
            letter-spacing: 0.5px;
        }

        .tagline {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            background: white;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #d04a02;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .page-title h1 {
            color: #333;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .page-title p {
            color: #666;
            font-size: 1.1em;
        }

        .card {
            background: white;
            border-radius: 2px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-top: 3px solid #d04a02;
        }

        .card h2 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 20px;
            font-weight: 400;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 15px;
        }

        .architecture-flow {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 40px;
        }

        .layer {
            background: white;
            border: 1px solid #e0e0e0;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            min-height: 200px;
        }

        .layer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            transition: background 0.3s ease;
        }

        .layer.active::before {
            background: #d04a02;
        }

        .layer.active {
            border-color: #d04a02;
            box-shadow: 0 4px 12px rgba(208, 74, 2, 0.15);
        }

        .layer h3 {
            color: #333;
            font-size: 1em;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .layer-content {
            font-size: 0.85em;
            color: #666;
            min-height: 100px;
        }

        .data-item {
            background: #f9f9f9;
            padding: 8px 12px;
            margin: 8px 0;
            border-left: 3px solid #d04a02;
            font-size: 0.9em;
        }

        .data-item strong {
            color: #333;
            display: inline-block;
            min-width: 120px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 0;
            font-size: 1em;
            transition: border-color 0.3s;
            background: #fafafa;
        }

        input:focus {
            outline: none;
            border-color: #d04a02;
            background: white;
        }

        .btn-primary {
            background: #d04a02;
            color: white;
            padding: 15px 50px;
            border: none;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-top: 20px;
        }

        .btn-primary:hover {
            background: #b33e02;
            box-shadow: 0 4px 12px rgba(208, 74, 2, 0.3);
        }

        .btn-primary:active {
            transform: translateY(1px);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 15px;
            border-radius: 0;
        }

        .status-processing {
            background: #ffd700;
            color: #333;
        }

        .status-complete {
            background: #00875a;
            color: white;
        }

        .status-idle {
            background: #e0e0e0;
            color: #666;
        }

        .output-section {
            display: none;
        }

        .output-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .personalized-message {
            background: #f9f9f9;
            border-left: 5px solid #d04a02;
            padding: 25px;
            margin-top: 20px;
            font-size: 1.05em;
            line-height: 1.8;
            color: #333;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: #fafafa;
            padding: 20px;
            border-left: 3px solid #d04a02;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #d04a02;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #d04a02;
            width: 0%;
            transition: width 0.5s ease;
        }

        .footer {
            background: #333;
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .footer p {
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 1200px) {
            .architecture-flow {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .architecture-flow {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }

            .metric-grid {
                grid-template-columns: 1fr;
            }
        }

        .arrow-connector {
            display: none;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #d04a02;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: 700;
            margin-right: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo">Hi Zinedine, welcome back</div>
        </div>
    </div>

    <div class="container">
        <!-- Page Title -->
        <div class="page-title">
            <h1>GlobalFin Customer Data Platform</h1>
            <p>Enterprise Architecture Demonstration - Real-time Customer Profile Enrichment & Orchestration</p>
        </div>

        <!-- Input Section -->
        <div class="card">
            <h2>Customer Data Input</h2>
            <form id="customerForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" placeholder="Enter first name" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" placeholder="Enter last name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="customer@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="age">Age</label>
                        <input type="number" id="age" min="18" max="100" placeholder="35" required>
                    </div>
                </div>
                <button type="submit" class="btn-primary">Process Customer Journey</button>
            </form>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar" id="progressBar" style="display: none;">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- Architecture Flow -->
        <div class="card" id="flowCard" style="display: none;">
            <h2>Data Processing Pipeline</h2>
            <div class="architecture-flow" id="flowContainer">
                <div class="layer" id="sourceLayer">
                    <h3><span class="step-number">1</span>Source Systems</h3>
                    <div class="layer-content" id="sourceContent">
                        <p style="color: #999;">Awaiting input...</p>
                    </div>
                    <span class="status-badge status-idle" id="sourceStatus">Idle</span>
                </div>

                <div class="layer" id="transformLayer">
                    <h3><span class="step-number">2</span>Integration Layer</h3>
                    <div class="layer-content" id="transformContent">
                        <p style="color: #999;">Ready to transform...</p>
                    </div>
                    <span class="status-badge status-idle" id="transformStatus">Idle</span>
                </div>

                <div class="layer" id="mdmLayer">
                    <h3><span class="step-number">3</span>MDM Matching</h3>
                    <div class="layer-content" id="mdmContent">
                        <p style="color: #999;">Ready to match...</p>
                    </div>
                    <span class="status-badge status-idle" id="mdmStatus">Idle</span>
                </div>

                <div class="layer" id="cdpLayer">
                    <h3><span class="step-number">4</span>CDP Enrichment</h3>
                    <div class="layer-content" id="cdpContent">
                        <p style="color: #999;">Ready to enrich...</p>
                    </div>
                    <span class="status-badge status-idle" id="cdpStatus">Idle</span>
                </div>

                <div class="layer" id="cjopLayer">
                    <h3><span class="step-number">5</span>CJOP Activation</h3>
                    <div class="layer-content" id="cjopContent">
                        <p style="color: #999;">Ready to orchestrate...</p>
                    </div>
                    <span class="status-badge status-idle" id="cjopStatus">Idle</span>
                </div>
            </div>
        </div>

        <!-- Output Section -->
        <div class="card output-section" id="outputSection">
            <h2>Customer 360 Profile & Personalized Engagement</h2>
            
            <div class="metric-grid" id="metricsGrid"></div>
            
            <div id="outputContent"></div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <p>© 2025 GlobalFin | Customer Experience Transformation</p>
        </div>
    </div>

<script>
    const form = document.getElementById('customerForm');
    const flowCard = document.getElementById('flowCard');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const outputSection = document.getElementById('outputSection');
    const metricsGrid = document.getElementById('metricsGrid');

    // Gemini API Configuration
    const GEMINI_API_KEY = 'AIzaSyDNEchnzTrA9Ej8nko7LX2poS2NKHulyac';
    const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

    // MDM Database - store processed customers in memory
    const mdmDatabase = {
        customers: [],
        emailIndex: new Set(),
        nameIndex: new Map()
    };

    function checkForDuplicates(email, firstName, lastName) {
        const duplicates = {
            exactEmail: false,
            fuzzyName: false,
            matchedRecords: []
        };

        // Check exact email match
        if (mdmDatabase.emailIndex.has(email.toLowerCase())) {
            duplicates.exactEmail = true;
            const matched = mdmDatabase.customers.find(c => c.email.toLowerCase() === email.toLowerCase());
            if (matched) {
                duplicates.matchedRecords.push({
                    type: 'Exact Email Match',
                    record: `${matched.firstName} ${matched.lastName} (${matched.email})`,
                    goldenId: matched.goldenId
                });
            }
        }

        // Check fuzzy name match (Levenshtein-like)
        const fullName = `${firstName} ${lastName}`.toLowerCase();
        for (const customer of mdmDatabase.customers) {
            const existingName = `${customer.firstName} ${customer.lastName}`.toLowerCase();
            const similarity = calculateSimilarity(fullName, existingName);
            
            if (similarity > 0.8 && email.toLowerCase() !== customer.email.toLowerCase()) {
                duplicates.fuzzyName = true;
                duplicates.matchedRecords.push({
                    type: 'Fuzzy Name Match',
                    record: `${customer.firstName} ${customer.lastName} (${customer.email})`,
                    similarity: (similarity * 100).toFixed(1) + '%',
                    goldenId: customer.goldenId
                });
            }
        }

        return duplicates;
    }

    function calculateSimilarity(str1, str2) {
        const longer = str1.length > str2.length ? str1 : str2;
        const shorter = str1.length > str2.length ? str2 : str1;
        
        if (longer.length === 0) return 1.0;
        
        const editDistance = levenshteinDistance(longer, shorter);
        return (longer.length - editDistance) / longer.length;
    }

    function levenshteinDistance(str1, str2) {
        const matrix = [];
        
        for (let i = 0; i <= str2.length; i++) {
            matrix[i] = [i];
        }
        
        for (let j = 0; j <= str1.length; j++) {
            matrix[0][j] = j;
        }
        
        for (let i = 1; i <= str2.length; i++) {
            for (let j = 1; j <= str1.length; j++) {
                if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                    matrix[i][j] = matrix[i - 1][j - 1];
                } else {
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j - 1] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j] + 1
                    );
                }
            }
        }
        
        return matrix[str2.length][str1.length];
    }

    function addToMDM(goldenId, email, firstName, lastName) {
        const customer = {
            goldenId,
            email: email.toLowerCase(),
            firstName,
            lastName,
            timestamp: new Date()
        };
        
        mdmDatabase.customers.push(customer);
        mdmDatabase.emailIndex.add(email.toLowerCase());
        
        const nameKey = `${firstName}_${lastName}`.toLowerCase();
        if (!mdmDatabase.nameIndex.has(nameKey)) {
            mdmDatabase.nameIndex.set(nameKey, []);
        }
        mdmDatabase.nameIndex.get(nameKey).push(goldenId);
    }

    async function generatePersonalizedMessage(firstName, age, segment, ltv, riskScore) {
        const prompt = `You are a professional banking relationship manager at GlobalFin, a premium financial institution.

Customer Profile:
- Name: ${firstName}
- Age: ${age} years
- Segment: ${segment}
- Estimated Lifetime Value: €${ltv}
- Risk Score: ${riskScore}/100 (Low Risk)

Write a personalized, professional welcome message for this customer. The message should:
1. Be warm but professional (corporate banking tone)
2. Reference their specific segment and financial profile
3. Suggest 2-3 relevant products/services based on their age and segment
4. Be between 80-120 words
5. End with a clear call-to-action

Do not use generic phrases. Make it feel personally crafted for ${firstName}.`;

        try {
            const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 250,
                        topP: 0.8,
                        topK: 40
                    }
                })
            });

            if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
            }

            const data = await response.json();
            const message = data.candidates[0].content.parts[0].text;
            return message;

        } catch (error) {
            console.error('Gemini API Error:', error);
            return `Dear ${firstName}, welcome to GlobalFin. As a valued ${segment} customer, we're committed to your financial success. Our team has identified tailored solutions including premium banking services, investment opportunities, and personalized financial planning. Your dedicated relationship manager will contact you within 24 hours to discuss your goals. Thank you for choosing GlobalFin.`;
        }
    }

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('email').value;
        const age = parseInt(document.getElementById('age').value);

        // Show flow
        flowCard.style.display = 'block';
        progressBar.style.display = 'block';
        outputSection.classList.remove('show');
        progressFill.style.width = '0%';

        // Step 1: Source Systems
        progressFill.style.width = '20%';
        await processStep('source', {
            content: `
                <div class="data-item"><strong>First Name:</strong> ${firstName}</div>
                <div class="data-item"><strong>Last Name:</strong> ${lastName}</div>
                <div class="data-item"><strong>Email:</strong> ${email}</div>
                <div class="data-item"><strong>Age:</strong> ${age} years</div>
                <div class="data-item"><strong>Source:</strong> CRM System (Salesforce)</div>
                <div class="data-item"><strong>Timestamp:</strong> ${new Date().toLocaleString()}</div>
            `,
            processingTime: 800
        });

        await delay(600);

        // Step 2: Transformation
        progressFill.style.width = '40%';
        await processStep('transform', {
            content: `
                <div class="data-item"><strong>Data Cleansing:</strong> Complete</div>
                <div class="data-item"><strong>Email Format:</strong> ${email.toLowerCase()}</div>
                <div class="data-item"><strong>Name Standardization:</strong> Title Case Applied</div>
                <div class="data-item"><strong>Validation Status:</strong> ✓ Passed</div>
                <div class="data-item"><strong>Protocol:</strong> REST API → Kafka</div>
                <div class="data-item"><strong>Target Format:</strong> MDM Schema v2.1</div>
            `,
            processingTime: 1400
        });

        await delay(900);

        // Step 3: MDM Matching with duplicate detection
        progressFill.style.width = '60%';
        
        // Check for duplicates BEFORE creating golden record
        const duplicateCheck = checkForDuplicates(email, firstName, lastName);
        
        const goldenId = `GR-${Math.floor(Math.random() * 90000) + 10000}`;
        const confidence = duplicateCheck.exactEmail ? 0.45 : 
                         duplicateCheck.fuzzyName ? (Math.random() * 0.10 + 0.75) :
                         (Math.random() * 0.15 + 0.85);
        
        let mdmContent = `
            <div class="data-item"><strong>Golden Record ID:</strong> ${goldenId}</div>
            <div class="data-item"><strong>Match Confidence:</strong> ${(confidence * 100).toFixed(1)}%</div>
            <div class="data-item"><strong>MDM Database Size:</strong> ${mdmDatabase.customers.length} records</div>
        `;
        
        if (duplicateCheck.exactEmail || duplicateCheck.fuzzyName) {
            const matchType = duplicateCheck.exactEmail ? 'EXACT EMAIL DUPLICATE' : 'FUZZY NAME MATCH';
            const statusColor = duplicateCheck.exactEmail ? '#dc3545' : '#ffc107';
            
            mdmContent += `
                <div class="data-item" style="background: ${statusColor}; color: white; font-weight: bold;">
                    <strong>⚠️ ${matchType} DETECTED</strong>
                </div>
            `;
            
            duplicateCheck.matchedRecords.forEach(match => {
                mdmContent += `
                    <div class="data-item" style="border-left-color: ${statusColor};">
                        <strong>${match.type}:</strong> ${match.record}
                        ${match.similarity ? ` (${match.similarity} similar)` : ''}
                    </div>
                    <div class="data-item" style="border-left-color: ${statusColor};">
                        <strong>Existing Golden ID:</strong> ${match.goldenId}
                    </div>
                `;
            });
            
            if (duplicateCheck.exactEmail) {
                mdmContent += `
                    <div class="data-item"><strong>Action:</strong> Record rejected - Use existing Golden ID</div>
                    <div class="data-item"><strong>Status:</strong> ❌ Duplicate not created</div>
                `;
            } else {
                mdmContent += `
                    <div class="data-item"><strong>Action:</strong> Manual review required</div>
                    <div class="data-item"><strong>Status:</strong> ⚠️ Flagged for review</div>
                `;
            }
        } else {
            mdmContent += `
                <div class="data-item"><strong>Duplicate Check:</strong> ✓ No matches found</div>
                <div class="data-item"><strong>Identity Resolution:</strong> New unique record</div>
                <div class="data-item"><strong>Data Quality Score:</strong> 96/100</div>
                <div class="data-item"><strong>Status:</strong> ✅ Golden Record Created</div>
            `;
            
            // Add to MDM database only if not duplicate
            addToMDM(goldenId, email, firstName, lastName);
        }

        await processStep('mdm', {
            content: mdmContent,
            processingTime: 2200
        });

        // If exact duplicate, stop pipeline and show warning
        if (duplicateCheck.exactEmail) {
            await delay(1000);
            
            document.getElementById('outputContent').innerHTML = `
                <div style="background: #dc3545; color: white; padding: 20px; border-radius: 5px; margin-top: 20px;">
                    <h3 style="color: white; margin-bottom: 10px;">❌ Duplicate Customer Detected</h3>
                    <p style="margin: 10px 0;"><strong>Email:</strong> ${email}</p>
                    <p style="margin: 10px 0;"><strong>Existing Record:</strong> ${duplicateCheck.matchedRecords[0].record}</p>
                    <p style="margin: 10px 0;"><strong>Golden ID:</strong> ${duplicateCheck.matchedRecords[0].goldenId}</p>
                    <hr style="border-color: rgba(255,255,255,0.3); margin: 15px 0;">
                    <p style="margin-top: 15px;">This customer already exists in the MDM system. Please use the existing Golden Record for any operations.</p>
                </div>
            `;
            outputSection.classList.add('show');
            outputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            return; // Stop pipeline
        }

        await delay(1100);

        // Step 4: CDP
        progressFill.style.width = '80%';
        const segment = age < 30 ? 'Young Professional' : age < 50 ? 'Mid-Career Wealth Builder' : 'Senior Wealth Management';
        const ltv = (age * 125 + Math.floor(Math.random() * 5000)).toLocaleString();
        const riskScore = Math.floor(Math.random() * 30 + 70);
        await processStep('cdp', {
            content: `
                <div class="data-item"><strong>Customer Segment:</strong> ${segment}</div>
                <div class="data-item"><strong>Lifetime Value (LTV):</strong> €${ltv}</div>
                <div class="data-item"><strong>Risk Assessment:</strong> ${riskScore}/100 (Low Risk)</div>
                <div class="data-item"><strong>Product Holdings:</strong> 2 Active Accounts</div>
                <div class="data-item"><strong>Propensity Model:</strong> High savings potential</div>
                <div class="data-item"><strong>Next-Best-Product:</strong> Investment Portfolio</div>
            `,
            processingTime: 1600
        });

        await delay(800);

        // Step 5: CJOP
        progressFill.style.width = '100%';
        
        const cjopLayer = document.getElementById('cjopLayer');
        const cjopContent = document.getElementById('cjopContent');
        const cjopStatus = document.getElementById('cjopStatus');
        
        cjopLayer.classList.add('active');
        cjopStatus.textContent = 'Processing...';
        cjopStatus.className = 'status-badge status-processing';
        
        cjopContent.innerHTML = `
            <div class="data-item"><strong>Orchestration Engine:</strong> Real-time decisioning</div>
            <div class="data-item"><strong>Channel Selection:</strong> Mobile App + Email</div>
            <div class="data-item"><strong>Campaign:</strong> ${segment} Welcome Journey</div>
            <div class="data-item"><strong>AI Engine:</strong> Gemini Pro (Generating...)</div>
        `;

        const aiMessage = await generatePersonalizedMessage(firstName, age, segment, ltv, riskScore);

        cjopContent.innerHTML = `
            <div class="data-item"><strong>Orchestration Engine:</strong> Real-time decisioning</div>
            <div class="data-item"><strong>Channel Selection:</strong> Mobile App + Email</div>
            <div class="data-item"><strong>Campaign:</strong> ${segment} Welcome Journey</div>
            <div class="data-item"><strong>AI Engine:</strong> Gemini Pro ✓</div>
            <div class="data-item"><strong>Timing Strategy:</strong> Immediate activation</div>
            <div class="data-item"><strong>Expected Conversion:</strong> 18.5%</div>
        `;

        cjopStatus.textContent = 'Complete';
        cjopStatus.className = 'status-badge status-complete';
        await delay(200);
        cjopLayer.classList.remove('active');

        await delay(700);

        const totalTime = (0.8 + 1.4 + 2.2 + 1.6 + 2.5).toFixed(1);

        metricsGrid.innerHTML = `
            <div class="metric-card">
                <div class="metric-value">€${ltv}</div>
                <div class="metric-label">Lifetime Value</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">${riskScore}/100</div>
                <div class="metric-label">Risk Score</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">${totalTime}s</div>
                <div class="metric-label">Processing Time</div>
            </div>
        `;

        let warningBadge = '';
        if (duplicateCheck.fuzzyName) {
            warningBadge = `
                <div style="background: #ffc107; color: #333; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <strong>⚠️ Note:</strong> Fuzzy name match detected. This record has been flagged for manual review.
                </div>
            `;
        }

        document.getElementById('outputContent').innerHTML = `
            ${warningBadge}
            <p style="margin: 20px 0;"><strong>Customer Profile:</strong> ${firstName} ${lastName} | ${age} years | ${email}</p>
            <p style="margin-bottom: 10px;"><strong>Segment Classification:</strong> ${segment}</p>
            <p style="margin-bottom: 20px;"><strong>Golden Record ID:</strong> ${goldenId}</p>
            <div class="personalized-message">
                <strong>AI-Generated Personalized Engagement:</strong><br>
                ${aiMessage}
            </div>
        `;
        outputSection.classList.add('show');
        outputSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    async function processStep(step, data) {
        const layer = document.getElementById(`${step}Layer`);
        const content = document.getElementById(`${step}Content`);
        const status = document.getElementById(`${step}Status`);

        layer.classList.add('active');
        status.textContent = 'Processing...';
        status.className = 'status-badge status-processing';

        await delay(data.processingTime * 0.3);
        content.innerHTML = data.content;

        const remaining = data.processingTime * 0.7;
        await delay(remaining);

        status.textContent = 'Complete';
        status.className = 'status-badge status-complete';
        
        await delay(200);
        layer.classList.remove('active');
    }

    function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
</script>


</body>
</html>
